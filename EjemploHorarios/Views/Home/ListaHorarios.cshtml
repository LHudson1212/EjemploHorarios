@{
    ViewBag.Title = "Listado de Horarios - SENA";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

<style>
    :root {
        --sena-green: #008037;
        --sena-green-light: #00a859;
        --sena-green-dark: #006028;
        --sena-green-glow: rgba(0, 168, 89, 0.4);
    }

    body {
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 50%, #f0fdf4 100%);
        min-height: 100vh;
    }

    h2 {
        font-weight: 800;
        background: linear-gradient(135deg, var(--sena-green), var(--sena-green-light));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .card {
        border-radius: 1.25rem;
        box-shadow: 0 4px 16px rgba(0, 0, 0, .08);
        border: 1px solid rgba(0,128,55,.1);
        background: #fff;
    }

    .table th {
        background: linear-gradient(135deg, var(--sena-green), var(--sena-green-light));
        color: #fff;
        text-align: center;
        font-weight: 600;
    }

    .btn-outline-sena {
        border: 2px solid var(--sena-green);
        color: var(--sena-green);
        border-radius: .85rem;
        font-weight: 600;
        background: transparent;
        transition: all .3s ease;
    }

        .btn-outline-sena:hover {
            background: var(--sena-green);
            color: #fff;
            box-shadow: 0 4px 10px rgba(0,128,55,.3);
        }

    .bg-sena {
        background: linear-gradient(135deg, var(--sena-green), var(--sena-green-light));
    }
</style>

<div class="container py-4">
    <div class="text-center mb-4">
        <h2>Gestión de Horarios</h2>
        <p class="text-muted mb-0">Consulta los horarios creados por ficha o por instructor</p>
    </div>

    <ul class="nav nav-pills justify-content-center mb-4" id="horariosTabs" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="fichas-tab" data-bs-toggle="pill" data-bs-target="#fichas" type="button">
                <i class="bi bi-journal-text me-1"></i> Por Ficha
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="instructores-tab" data-bs-toggle="pill" data-bs-target="#instructores" type="button">
                <i class="bi bi-person-badge me-1"></i> Por Instructor
            </button>
        </li>
    </ul>

    <div class="tab-content" id="horariosTabsContent">
        <!-- ================= TAB FICHAS ================= -->
        <div class="tab-pane fade show active" id="fichas" role="tabpanel">
            <div class="card mb-4">
                <div class="card-header bg-sena text-white fw-bold d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-journal-text me-2"></i>Horarios por Ficha</span>
                    <button class="btn btn-light btn-sm" onclick="window.location.href='@Url.Action("Index","Home")'">
                        <i class="bi bi-plus-circle me-1"></i> Crear Nuevo
                    </button>
                </div>
                <div class="card-body p-0">
                    <table class="table table-bordered align-middle mb-0">
                        <thead>
                            <tr>
                                <th>Ficha</th>
                                <th>Programa</th>
                                <th>Trimestre</th>
                                <th>Acción</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyFichas">
                            <tr><td colspan="4" class="text-center text-muted py-3">Cargando horarios...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ================= TAB INSTRUCTORES ================= -->
        <div class="tab-pane fade" id="instructores" role="tabpanel">
            <div class="card mb-4">
                <div class="card-header bg-sena text-white fw-bold">
                    <i class="bi bi-person-badge me-2"></i>Horarios por Instructor
                </div>
                <div class="card-body p-0">
                    <table class="table table-bordered align-middle mb-0">
                        <thead>
                            <tr>
                                <th>Instructor</th>
                                <th>Acción</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyInstructores">
                            <tr><td colspan="2" class="text-center text-muted py-3">Cargando horarios...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", () => {
    cargarHorariosFicha();
    cargarHorariosInstructor();
});

/* ====================== HORARIOS POR FICHA ====================== */
async function cargarHorariosFicha() {
    const tbody = document.getElementById("tbodyFichas");
    try {
        const resp = await fetch('@Url.Action("GetHorariosFicha","Home")');
        const json = await resp.json();

        if (!json.ok || !json.data.length) {
            tbody.innerHTML = `<tr><td colspan="4" class="text-center text-muted py-3">No hay horarios registrados.</td></tr>`;
            return;
        }

        tbody.innerHTML = "";
        json.data.forEach(h => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${h.CodigoFicha}</td>
                <td>${h.ProgramaNombre ?? ""}</td>
                <td>${h.Trimestre_Año}</td>
                <td class="text-center">
                    <button class="btn btn-outline-sena btn-sm" onclick="verHorarioFicha(${h.IdFicha})">
                        <i class="bi bi-eye-fill"></i> Ver
                    </button>
                </td>`;
            tbody.appendChild(tr);
        });
    } catch (err) {
        tbody.innerHTML = `<tr><td colspan="4" class="text-center text-danger py-3">Error: ${err.message}</td></tr>`;
    }
}

/* ====================== HORARIOS POR INSTRUCTOR ====================== */
async function cargarHorariosInstructor() {
    const tbody = document.getElementById("tbodyInstructores");
    try {
        // 🔹 ahora apunta al nuevo método
        const resp = await fetch('@Url.Action("GetHorariosInstructores","Home")');
        const json = await resp.json();

        if (!json.ok || !json.data.length) {
            tbody.innerHTML = `<tr><td colspan="2" class="text-center text-muted py-3">No hay horarios asignados.</td></tr>`;
            return;
        }

        tbody.innerHTML = "";
        json.data.forEach(h => {
            const idInstructor = h.IdInstructor || 0;
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${h.NombreInstructor ?? "Sin nombre"}</td>
                <td class="text-center">
                    <button class="btn btn-outline-sena btn-sm" onclick="verHorarioInstructor(${idInstructor})">
                        <i class="bi bi-eye-fill"></i> Ver
                    </button>
                </td>`;
            tbody.appendChild(tr);
        });
    } catch (err) {
        tbody.innerHTML = `<tr><td colspan="2" class="text-center text-danger py-3">Error: ${err.message}</td></tr>`;
    }
}

/* ====================== REDIRECCIONES ====================== */
function verHorarioFicha(idFicha) {
    const baseUrl = '@Url.Action("VerHorarioFicha", "Home")';
    window.location.href = `${baseUrl}?idFicha=${idFicha}`;
}

function verHorarioInstructor(idInstructor) {
    const baseUrl = '@Url.Action("VerHorarioInstructor", "Home")';
    window.location.href = `${baseUrl}?idInstructor=${idInstructor}`;
}
    </script>
}